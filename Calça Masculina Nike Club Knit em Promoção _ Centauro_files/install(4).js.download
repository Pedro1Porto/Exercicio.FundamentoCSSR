(()=>{"use strict";let e=async e=>{let t=await fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let r=await t.text();return r?JSON.parse(r):null},t={URL:"https://"+__CUSTOMDATA__.client+".mais.social/",serverID:__CUSTOMDATA__.initials},r=!1,{URL:a}=t,n=["ageGroup","artist","author","brand","catalogColorName","catalogColorfulness","catalogPredominantColor","catalogSize","category","department","description","designer","ean","fulfillmentBy","gender","images","isExclusive","label","name","price","productId","productId2","salePrice","seller","sku","subCategory"],o=["ageGroup","artist","author","brand","catalogColorName","catalogSize","category","department","designer","fulfillmentBy","gender","label","name","seller","subCategory"],i=["ean","productId","productId2","sku"],s=class{constructor(e){this.url=e,this.url}async set(){let{productId:e,initials:t,images:r}=window.__CUSTOMDATA__||{};if(!this.isValidProductData(e,r))return;let a=this.getProps();!(!this.areUrlsValid(a)||this.isRestrictedUrl(a.url))&&await this.sendDataToApi(t,a)}isValidProductData(e,t){return!!e&&!!t}areUrlsValid(e){for(let t of["imageURL","imageURLSecondary","url"])if(e[t]&&!function(e){try{return new URL(e),!0}catch(e){return!1}}(e[t]))return!1;return!0}isRestrictedUrl(e){return["cart","checkout","checkouts","customer","carrinho"].some(t=>RegExp(`(^|/)${t}(/|$)`,"i").test(e))}async sendDataToApi(t,r){if(this.isProductInfoRepeated(r))return;let n=this.constructDataString(r),o=window.__CUSTOMDATA__.operator?`&operator=${window.__CUSTOMDATA__.operator}`:"";await e(`${a}api/pdp/product-events?ecommerceId=${t}&${n}${o}`),window.__CUSTOMDATA__.productEvents||(window.__CUSTOMDATA__.productEvents={}),window.__CUSTOMDATA__.productEvents.lastSentProductInfo={productId:r.productId,productId2:r.productId2,sku:r.sku},window.__CUSTOMDATA__.productUrl&&(window.__CUSTOMDATA__.productUrl=null)}isProductInfoRepeated(e){let t=window.__CUSTOMDATA__.productEvents?.lastSentProductInfo;return!!t&&t.productId===e.productId&&t.productId2===e.productId2&&t.sku===e.sku}constructDataString(e){return Object.keys(e).sort().map(t=>`${t}=${encodeURIComponent(e[t])}`).join("&")}getProps(){let e={};return e.url=this.url,n.forEach(t=>{var r;let a=window.__CUSTOMDATA__[t],n=null==a?"isExclusive"!==t&&"":a;"images"===t?n&&n[0]?(e.imageURL=n[0][0]||"",e.imageURLSecondary=n[0][1]||""):(e.imageURL="",e.imageURLSecondary=""):(Array.isArray(n)&&(n=n.join(",")),o.includes(t)&&(n=function(e,t=3169){if(null==e||"string"!=typeof e&&"string"!=typeof(e=e.toString()))return"";if(/(&[a-z0-9#]{2,10};)|(<[^>]*>)/i.test(e)){var r=document.createElement("textarea");r.innerHTML=e,e=r.value}return e=function(e){let t=["and","e","de","van","von","av"],r=e.toLowerCase().split(/[\s-_]+/),a=r.map((e,r)=>{if(t.includes(e)&&0!==r)return e;{let t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=t.charAt(0).toUpperCase()+e.slice(1);return r}});return a.join(" ")}(e=e.replace(/<[^>]*>/g," ").replace(/\r?\n|\r/g," ").replace(/\s+/g," ").substring(0,t).trim())}(n)),i.includes(t)&&(n=null==(r=n)||"string"!=typeof r&&"string"!=typeof(r=r.toString())?"":r=(r=r.replace(/\s+/g,"")).toLowerCase()),"description"===t&&(n=function(e,t=3169){try{var r;if(null==e||("string"!=typeof e&&(e=e.toString()),"string"!=typeof e))return"";let a=document.createElement("textarea"),n=/([.!?])$/;r=e=(e=e.replace(/<(script|style)[^>]*>[\s\S]*?<\/\1>/gi,"")).replace(/<!--[\s\S]*?-->/g,""),a.innerHTML=r,(e=(e=(e=(e=(e=a.value).replace(/(<(h[1-6]|p)[^>]*>)([^<]*)(<\/\2>)/gi,(e,t,r,a,o)=>n.test(a.trim())?e:`${t}${a.trim()}: ${o}`)).replace(/<[^>]*>/g,"")).replace(/\s?[¹²³⁴⁵⁶⁷⁸⁹*]+/g,"")).replace(/\. \.([0-9]+)/g,". $1").replace(/\.\./g,".").replace(/\s\?/g,"?").replace(/\r?\n|\r/g," ").replace(/\s+/g," ").trim()).length>0&&(e=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),e=(e=e.replace(/([.!?]\s*)([a-záéíóúãõâêôç])/g,(e,t,r)=>t+r.toUpperCase())).replace(/([.!?])(\s+)([a-záéíóúãõâêôç])/g,(e,t,r,a)=>t+" "+a.toUpperCase());let o=e.lastIndexOf(".");return -1!==o&&(e=e.slice(0,o+1)),e.substring(0,t).trim()}catch(e){return""}}(n)),("price"===t||"salePrice"===t)&&(n=function(e){"string"!=typeof e&&(e=String(e)),e=(e=e.trim()).includes(".")?e.replace(/[^0-9.]/g,""):(e=e.replace(/[^0-9,]/g,"")).replace(",",".");let t=parseFloat(e);return isNaN(t)?"":t.toFixed(2)}(n)),e[t]=n,e[t])}),e}};async function l(e){if(!e)return;r||(console.info("%cVurdere%cis loaded: harnessing Social+ AI and Elegance to boost your store's engagement and conversions.","background: black; color: #FFA100; font-weight: bold; padding: 3px;","background: black; color: white; padding: 3px;"),r=!0);let t=new s(e);await t.set()}let c=((e,t,r)=>{let a;return function(...t){let n=this,o=()=>{a=null,r||e.apply(n,t)},i=r&&!a;clearTimeout(a),a=setTimeout(o,500),i&&e.apply(n,t)}})(l,0,!1);window.vurdereSendSocialEvents=c})();